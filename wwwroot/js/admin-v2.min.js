//PawVerse AdminV2 - MainJavaScript

document.addEventListener('DOMContentLoaded',function(){
//Hide preloader when page is fully loaded
const preloader=document.querySelector('.admin-preloader');
if (preloader){
setTimeout(()=>{
preloader.classList.add('admin-loaded');
//Remove preloader from DOM after animation completes
setTimeout(()=>{
preloader.style.display='none';
},500);
},500);
}

//Toggle sidebar
const sidebarTogglers=document.querySelectorAll('.admin-sidebar-toggler,.admin-sidebar-toggle');
const body=document.body;

sidebarTogglers.forEach(toggler=>{
toggler.addEventListener('click',function(e){
e.preventDefault();
body.classList.toggle('admin-sidebar-collapsed');

//Save sidebar stateinlocalStorage
if (body.classList.contains('admin-sidebar-collapsed')){
localStorage.setItem('adminSidebarCollapsed','true');
}else{
localStorage.setItem('adminSidebarCollapsed','false');
}
});
});

//Check for saved sidebar state
if (localStorage.getItem('adminSidebarCollapsed')==='true'){
body.classList.add('admin-sidebar-collapsed');
}

//Mobile sidebar toggle
const mobileSidebarToggle=document.querySelector('.admin-sidebar-toggle');
const sidebar=document.querySelector('.admin-sidebar');

if (mobileSidebarToggle&&sidebar){
mobileSidebarToggle.addEventListener('click',function(){
sidebar.classList.toggle('show');
document.body.style.overflow=document.body.style.overflow==='hidden'?'':'hidden';
});
}

//Close mobile sidebar when clicking outside
document.addEventListener('click',function(e){
if (window.innerWidth<=992){
if (!sidebar.contains(e.target)&&!e.target.closest('.admin-sidebar-toggle')){
sidebar.classList.remove('show');
document.body.style.overflow='';
}
}
});

//Scroll to top button
const scrollToTopBtn=document.querySelector('.admin-scroll-to-top');

if (scrollToTopBtn){
window.addEventListener('scroll',function(){
if (window.pageYOffset>300){
scrollToTopBtn.classList.add('visible');
}else{
scrollToTopBtn.classList.remove('visible');
}
});

scrollToTopBtn.addEventListener('click',function(e){
e.preventDefault();
window.scrollTo({
top:0,
behavior:'smooth'
});
});
}

//initialize tooltips
const tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
tooltipTriggerList.map(function (tooltipTriggerEl){
return new bootstrap.Tooltip(tooltipTriggerEl);
});

//initialize popovers
const popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
popoverTriggerList.map(function (popoverTriggerEl){
return new bootstrap.Popover(popoverTriggerEl);
});

//Active menu item highlighting
const currentPath=window.location.pathname;
const navLinks=document.querySelectorAll('.admin-sidebar-menu .nav-link');

navLinks.forEach(link=>{
if (link.getAttribute('href')===currentPath){
link.classList.add('active');
//Also activate parent dropdown if exists
const parentDropdown=link.closest('.dropdown-menu');
if (parentDropdown){
const dropdownToggle=parentDropdown.previousElementSibling;
if (dropdownToggle&&dropdownToggle.classList.contains('dropdown-toggle')){
dropdownToggle.classList.add('active');
parentDropdown.classList.add('show');
}
}
}
});

//Handle dropdown menus
const dropdownToggles=document.querySelectorAll('.dropdown-toggle');

dropdownToggles.forEach(toggle=>{
toggle.addEventListener('click',function(e){
e.preventDefault();
const dropdownMenu=this.nextElementSibling;
if (dropdownMenu&&dropdownMenu.classList.contains('dropdown-menu')){
dropdownMenu.classList.toggle('show');
this.setAttribute('aria-expanded',dropdownMenu.classList.contains('show'));
}
});
});

//Close dropdowns when clicking outside
document.addEventListener('click',function(e){
if (!e.target.matches('.dropdown-toggle')&&!e.target.closest('.dropdown-menu')){
const dropdowns=document.querySelectorAll('.dropdown-menu');
dropdowns.forEach(dropdown=>{
if (dropdown.classList.contains('show')){
dropdown.classList.remove('show');
const toggle=dropdown.previousElementSibling;
if (toggle&&toggle.classList.contains('dropdown-toggle')){
toggle.setAttribute('aria-expanded','false');
}
}
});
}
});

//Handle notification dropdown
const notificationBtn=document.querySelector('.admin-notification-btn');
const notificationDropdown=document.querySelector('.admin-notification-dropdown');

if (notificationBtn&&notificationDropdown){
notificationBtn.addEventListener('click',function(e){
e.preventDefault();
e.stopPropagation();
notificationDropdown.classList.toggle('show');
});

//Close notification dropdown when clicking outside
document.addEventListener('click',function(e){
if (!e.target.closest('.admin-notification')&&notificationDropdown.classList.contains('show')){
notificationDropdown.classList.remove('show');
}
});
}

//Handle profile dropdown
const profileBtn=document.querySelector('.admin-profile');
const profileDropdown=document.querySelector('.admin-profile-dropdown');

if (profileBtn&&profileDropdown){
profileBtn.addEventListener('click',function(e){
e.preventDefault();
e.stopPropagation();
profileDropdown.classList.toggle('show');
});

//Close profile dropdown when clicking outside
document.addEventListener('click',function(e){
if (!e.target.closest('.admin-profile')&&profileDropdown.classList.contains('show')){
profileDropdown.classList.remove('show');
}
});
}

//Handle search functionality
const searchinput=document.querySelector('.admin-searchinput');
if (searchinput){
searchinput.addEventListener('keypress',function(e){
if (e.key==='Enter'){
e.preventDefault();
const searchTerm=this.value.trim();
if (searchTerm){
//Implement search functionality here
console.log('Searching for:',searchTerm);
//window.location.href=`/Admin/Search?q=${encodeURIComponent(searchTerm)}`;
}
}
});
}

//Handle responsive tables
const tables=document.querySelectorAll('.admin-table-responsive');

tables.forEach(table=>{
const wrapper=document.createElement('div');
wrapper.className='table-responsive';
table.parentNode.insertBefore(wrapper,table);
wrapper.appendChild(table);
});

//initialize any charts if Chart.js is loaded
if (typeof Chart!=='undefined'){
initializeCharts();
}
});

//initialize charts
functioninitializeCharts(){
//Area Chart Example
const areaChartCtx=document.getElementById('adminAreaChart');
if (areaChartCtx){
new Chart(areaChartCtx,{
type:'line',
data:{
labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
datasets:[{
label:'Revenue',
data:[0,10000,5000,15000,10000,20000,15000,25000,20000,30000,25000,40000],
backgroundColor:'rgba(78,115,223,0.1)',
borderColor:'rgba(78,115,223,1)',
pointBackgroundColor:'rgba(78,115,223,1)',
pointBorderColor:'#fff',
pointHoverBackgroundColor:'#fff',
pointHoverBorderColor:'rgba(78,115,223,1)',
pointHoverRadius:5,
pointHitRadius:10,
pointBorderWidth:2,
tension:0.3
}]
},
options:{
maintainAspectRatio:false,
plugins:{
legend:{
display:false
},
tooltip:{
backgroundColor:'rgba(0,0,0,0.8)',
titleFont:{
size:14,
weight:'normal'
},
bodyFont:{
size:14
},
callbacks:{
label:function(context){
return ' '+context.parsed.y.toLocaleString()+' VND';
}
}
}
},
scales:{
x:{
grid:{
display:false
},
ticks:{
font:{
size:12
}
}
},
y:{
beginAtZero:true,
grid:{
color:'rgba(0,0,0,0.05)'
},
ticks:{
font:{
size:12
},
callback:function(value){
return value.toLocaleString()+' VND';
}
}
}
}
}
});
}

//Donut Chart Example
const donutChartCtx=document.getElementById('adminDonutChart');
if (donutChartCtx){
new Chart(donutChartCtx,{
type:'doughnut',
data:{
labels:['Direct','Social','Referral'],
datasets:[{
data:[55,30,15],
backgroundColor:['#4e73df','#1cc88a','#36b9cc'],
hoverBackgroundColor:['#2e59d9','#17a673','#2c9faf'],
hoverBorderColor:'rgba(234,236,244,1)',
}],
},
options:{
maintainAspectRatio:false,
plugins:{
tooltip:{
backgroundColor:'rgba(0,0,0,0.8)',
bodyFont:{
size:14
},
callbacks:{
label:function(context){
const label=context.label||'';
const value=context.raw||0;
const total=context.dataset.data.reduce((a,b)=>a+b,0);
const percentage=Math.round((value/total)*100);
return ` ${label}:${percentage}%(${value})`;
}
}
},
legend:{
position:'bottom',
labels:{
font:{
size:12
},
padding:20,
usePointStyle:true,
pointStyle:'circle'
}
}
},
cutout:'70%'
},
});
}
}

//Export functions for useinother scripts
window.PawVerseAdmin={
toggleSidebar:function(){
document.body.classList.toggle('admin-sidebar-collapsed');
},
showAlert:function(message,type='success'){
const alert=document.createElement('div');
alert.className=`admin-alert admin-alert-${type}alert-dismissible fade show`;
alert.role='alert';
alert.innerHTML=`
${message}
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
`;

const container=document.querySelector('.admin-content');
if (container){
container.insertBefore(alert,container.firstChild);

//Auto-dismiss after 5 seconds
setTimeout(()=>{
const bsAlert=new bootstrap.Alert(alert);
bsAlert.close();
},5000);
}
}
};

//initialize any plugins that need to run after DOM is fully loaded
window.addEventListener('load',function(){
//Add any additionalinitialization code here
});
